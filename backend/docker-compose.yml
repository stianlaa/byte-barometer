version: '3'

services:
  byte-barometer:
    image: byte-barometer:latest
    # Used for initial population 
    # entrypoint: python3 tool.py populate -l 72000 -d 10000
    entrypoint: gunicorn -k eventlet -w 1 -b 0.0.0.0:3000 app:app
    build:
      context: .
      dockerfile: Dockerfile

    env_file:
      - ../.env
    environment:
      - ENABLE_GPU=True
    volumes:
      - .:/app
      - ~/.cache/huggingface/transformers:/app/.cache/huggingface/transformers
    ports:
      - "3000:3000"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities:
                - gpu
                - utility # nvidia-smi
                - compute # CUDA
                - video   # NVDEC/NVENC/NVCUVID
    
